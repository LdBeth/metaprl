#
# JYH: this file is all wrong.  Will have to fix it when we actually
# want to include ensemble again.
#
OCAMLFLAGS += -rectypes
#
# Name of this library
#
LIBNAME = trefiner

#
# We haven't used Ensemble in several years,
# so this code is likely to fail.
#
MLZFILES[] =
    remote_sig

HOSTTYPE =
MAIN =

LMFILES[] =
    appl_outboard_common
    appl_outboard_client
    ensemble_queue
    remote_sig
    remote_null
    remote_ensemble
    remote_monitor
    thread_refiner

OCAML_CLIBS[] =
    $(LIB)/trefiner

#
# Server program
#
MSFILES[] =
    appl_outboard_common
    appl_outboard_server

LIBS_serv[] =
    $(CAMLLIB)/unix.cma
    $(THREADSLIB)
    $(ENSROOT)/lib/$(HOSTTYPE)/socket.cma
    $(ENSROOT)/lib/$(HOSTTYPE)/_nulldynlink.cmo
    $(ENSROOT)/lib/$(HOSTTYPE)/libenscore.cma
    $(ENSROOT)/lib/$(HOSTTYPE)/libensmin.cma
    $(ENSROOT)/lib/$(HOSTTYPE)/libensrest.cma
    $(LIB)/util.cma
    $(MAIN).cma

OTHERLIBS_serv[] =
    $(ENSROOT)/lib/$(HOSTTYPE)/socket.cmxa
    $(ENSROOT)/lib/$(HOSTTYPE)/libenscore.cmxa
    $(ENSROOT)/lib/$(HOSTTYPE)/libensmin.cmxa
    $(ENSROOT)/lib/$(HOSTTYPE)/libensrest.cmxa

CLIBS_serv = $(LIB)/clib

OTHER_CCLIBS_serv =\
    -cclib -lunix\
    -ccopt -L$(ENSROOT)/lib/$(HOSTTYPE)\
    -cclib -lsock\

NATIVE_CCLIBS_serv =\
    -cclib -lunix\
    -ccopt -L$(ENSROOT)/lib/$(HOSTTYPE)\
    -cclib -lsock\

OCAMLINCLUDES[] +=
       $(ENSROOT)/lib/$(HOSTTYPE)

#
# Name of the server
#
MPSERVER = mpserver
MFILES = $(LMFILES) $(LMFILES)

ENS_LIB = $(LIBNAME).cma
OPT_ENS_LIB = $(LIBNAME).cmxa
RENS_LIB = $(LIB)/$(ENS_LIB)
ROPT_ENS_LIB = $(LIB)/$(OPT_ENS_LIB) $(LIB)/$(LIBNAME)$(EXT_LIB)

section
    OCAMLINCLUDES += $(ENSROOT)/lib
    OCAML_CLIBS = $(ENSROOT)/libsock
    OCAML_LIBS[] =
        $(ENSROOT)/socket
        $(ENSROOT)/libenscore
        $(ENSROOT)/libensmin

    OCAML_OTHER_LIBS = unix

    # see https://github.com/LdBeth/metaprl/blob/ab77bd0ea01301f92797452b2d33f0d4f936aa7f/tactics/ensemble/Makefile
    OCamlProgram($(MPSERVER), $(MSFILES))

OCamlLibraryInstall($(MPINSTALL), $(LIB), $(LIBNAME), $(LMFILES))

#
# Clean up
#
clean:
    $(CLEAN)
