#
# Don't try to scan files in this directory.
# List the dependencies explicitly.
#
.SCANNER: %.cmx %.cmo %.cmi
	@

if $(NATIVE_PROFILING_ENABLED)
   NATIVE_ENABLED = false
   export

if $(NATIVE_ENABLED)
   BYTE_ENABLED = false
   export

OCAMLDEP = $(file ocamldep$(EXE))
BINDEP   = $(file $(BIN)/ocamldep$(EXE))

#
# We also use our own version of ocamldep
#
OCamlProgramInstall($(MPINSTALL), $(BIN), ocamldep, ocamldep)

ocamldep$(EXT_OBJ) ocamldep.cmx ocamldep.cmo ocamldep.cmi:

#
# Phony targets
#
install: $(BINDEP)

clean:
	$(CLEAN) *.cm* *~ ocamldep.ml *.o *.exe Makefile.dep ocamldep ocamldep.opt ocamldep.run

#
# Macros
#
OCAML_LIBS += $(CAMLP4LIB)/odyl $(CAMLP4LIB)/camlp4
OCAMLINCLUDES += $(CAMLP4LIB)
OCAML_LINK_FLAGS += -linkall
OCAMLFLAGS += -pp "$(CAMLP4R) -I $(CAMLP4LIB) -nolib"

%.cmx %.o: $(CAMLP4R_VERSION)
%.cmo: $(CAMLP4R_VERSION)
%.cmi: $(CAMLP4R_VERSION)

MACRO_FILES =\
   $(CAMLP4LIB)/pa_o\
   pa_macro\
   macro_main\

OCamlProgramInstall($(MPINSTALL), $(LIB), macropp, $(CAMLP4LIB)/pr_dump $(MACRO_FILES))
OCamlProgramInstall($(MPINSTALL), $(LIB), macroprint, $(CAMLP4LIB)/pr_o $(MACRO_FILES))
