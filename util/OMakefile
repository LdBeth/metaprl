#
# Don't try to scan files in this directory
#
.SCANNER: %

misc.cmo: misc.cmi
misc.cmx: misc.cmi
ocamldep.cmo: misc.cmi
ocamldep.cmx: misc.cmi misc.cmx

OCAMLDEP = $(file ocamldep$(EXE))
BINDEP   = $(file $(BIN)/ocamldep$(EXE))

MACROCMO = $(file macro.cmo)
LIBMACRO = $(file $(LIB)/macro.cmo)

#
# The MetaPRL macro preprocessor
#
macro.cmo: macro.ml
	$(OCAMLC) $(OCAMLCFLAGS) -pp "camlp4o -I $(CAMLP4LIB) pa_extend.cmo q_MLast.cmo" -I $(CAMLP4LIB) -c macro.ml

$(LIBMACRO): $(MACROCMO)
	$(CP) $< $@

#
# We also use our own version of ocamldep
#
OCamlProgramInstall($(MPINSTALL), $(BIN), ocamldep, misc ocamldep)

#
# Phony targets
#
install: $(BINDEP)

clean:
	$(RM) *.cm* *~ ocamldep.ml *.o *.exe Makefile.dep ocamldep ocamldep.opt ocamldep.run
