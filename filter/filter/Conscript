Import qw( env );

$env = $env->clone(
	INCPATH	=> [@{$env->{INCPATH}}, "../base", "../boot"],
	OCAMLC => "$env->{OCAMLC} -I /usr/lib/camlp4",
	OCAMLLINK => "$env->{OCAMLLINK} -I /usr/lib/camlp4",
	OCAMLCFLAGS => "$env->{OCAMLCFLAGS} -linkall -pp '%CAMLP4MACRO'",
    	PPFLAGS     => "q_MLast.cmo pa_extend.cmo $env->{PPFLAGS}",
        MLLIBS => "unix.cmxa threads.cmxa",
        CCLIBS => "-cclib clib/clib.a"
);

$nenv = $env->clone(
	MLLIBS => "$env->{MLLIBS} odyl.cmxa camlp4.cmxa pa_o.cmx pr_dump.cmx pa_extend.cmx q_MLast.cmx"
);

$oenv = $env->clone(
	MLLIBS => "$env->{MLLIBS} odyl.cmxa camlp4.cmxa pa_o.cmx pr_o.cmx pa_extend.cmx q_MLast.cmx"
);

$poenv = $env->clone(
	MLLIBS => "$env->{MLLIBS} odyl.cmxa camlp4.cmxa pr_dump.cmx"
);

$pnenv = $env->clone(
	MLLIBS => "$env->{MLLIBS} odyl.cmxa camlp4.cmxa pr_o.cmx"
);

$penv = $env->clone(
	MLLIBS => "unix.cmxa",
	OCAMLCFLAGS => ""
);

OCamlSources $env
	'filter_parse.ml',
	'filter_main.ml',
	'filter_bin.ml',
	'filter_convert.ml',
	'prlcomp.ml';

# filter_mail.ml uses external symbols from clib.a
Depends $env 'filter_main'.$env->{SUFOBJ}, "#clib/clib.a";

OCamlLibrary $env 'filter',
	'filter_parse',
	'filter_main',
	'filter_bin',
	'filter_convert',
	'prlcomp';

OCamlProgram $nenv  'camlp4n', 'filter_main';
OCamlProgram $oenv  'camlp4o', 'filter_main';
OCamlProgram $pnenv 'prlcn', 'filter_bin';
OCamlProgram $poenv 'prlco', 'filter_bin';
OCamlProgram $env   'convert', 'filter_convert';
OCamlProgram $penv  'prlc', 'prlcomp';

## Add the library to the default target list
Default qw( filter.cmxa camlp4n camlp4o prlcn prlco prlc );
