Import qw( env );

$env = $env->clone(
    INCPATH	=> [@{$env->{INCPATH}}, "../refbase", "../refsig"],
    PPFLAGS     => "$env->{PPFLAGS} -Irefiner/refsig",
);

Command $env 'rewrite_type_sig.ml', 'rewrite_types.ml', qq(
	%CAMLP4MACROPRINT -intf %1 -o %>
);

OCamlSources $env
	'rewrite_type_sig.ml',
	'rewrite_util_sig.mlz',
	'rewrite_debug_sig.mlz',
	'rewrite_compile_redex_sig.mlz',
	'rewrite_compile_contractum_sig.mlz',
	'rewrite_match_redex_sig.mlz',
	'rewrite_build_contractum_sig.mlz',
	'rewrite_meta_sig.mlz',
	'rewrite_types.ml',
	'rewrite_util.ml',
	'rewrite_debug.ml',
	'rewrite_compile_redex.ml',
	'rewrite_compile_contractum.ml',
	'rewrite_match_redex.ml',
	'rewrite_build_contractum.ml',
	'rewrite_meta.ml',
	'rewrite.ml';

OCamlLibrary $env 'rewrite',
	'rewrite_type_sig',
	'rewrite_util_sig',
	'rewrite_debug_sig',
	'rewrite_compile_redex_sig',
	'rewrite_compile_contractum_sig',
	'rewrite_match_redex_sig',
	'rewrite_build_contractum_sig',
	'rewrite_meta_sig',
	'rewrite_types',
	'rewrite_util',
	'rewrite_debug',
	'rewrite_compile_redex',
	'rewrite_compile_contractum',
	'rewrite_match_redex',
	'rewrite_build_contractum',
	'rewrite_meta',
	'rewrite';

## Add the library to the default target list
Default qw( rewrite.cmxa );
